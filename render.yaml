# ============================================
# Render Blueprint - SpendWise
# ============================================
# Este arquivo configura automaticamente os serviços no Render
# Docs: https://render.com/docs/blueprint-spec

services:
  # ============================================
  # PostgreSQL Database
  # ============================================
  - type: pserv
    name: spendwise-db
    plan: free
    databaseName: appdb
    user: appuser
    ipAllowList: []

  # ============================================
  # Backend API (.NET 9)
  # ============================================
  - type: web
    name: spendwise-backend
    env: docker
    plan: free
    region: oregon
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    healthCheckPath: /health
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_URLS
        value: http://+:5000
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: spendwise-db
          property: connectionString
      - key: JwtSettings__Secret
        generateValue: true
      - key: JwtSettings__Issuer
        value: SpendWise
      - key: JwtSettings__Audience
        value: SpendWise
      - key: JwtSettings__ExpirationInMinutes
        value: 60
      - key: CorsSettings__AllowedOrigins
        sync: false  # Configure manualmente após deploy do frontend

  # ============================================
  # Frontend (Next.js)
  # ============================================
  - type: web
    name: spendwise-frontend
    env: docker
    plan: free
    region: oregon
    dockerfilePath: ./frontend/Dockerfile
    dockerContext: ./frontend
    envVars:
      - key: NEXT_PUBLIC_API_URL
        sync: false  # Configure manualmente com a URL do backend
      - key: NODE_ENV
        value: production
